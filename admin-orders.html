<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© (Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }

    h2 {
      color: gold;
      text-align: center;
      margin-bottom: 30px;
    }

    .order-box {
      background-color: #1e1e1e;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
    }

    .order-box h3 {
      margin: 0 0 10px;
      color: #ffcc00;
    }

    .order-box p {
      margin: 4px 0;
    }

    .product-item {
      background: rgba(255,255,255,0.05);
      padding: 8px;
      border-radius: 8px;
      margin-top: 10px;
    }

    .whatsapp-btn, .delete-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 16px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
    }

    .whatsapp-btn {
      background-color: #25D366;
      color: white;
    }

    .delete-btn {
      background-color: #ff4d4d;
      color: white;
      margin-right: 10px;
      cursor: pointer;
    }

    #passwordPrompt {
      text-align: center;
      margin-top: 100px;
    }

    #passwordPrompt input {
      padding: 10px;
      font-size: 18px;
      width: 250px;
      border-radius: 6px;
      border: none;
      text-align: center;
    }

    #passwordPrompt button {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 10px;
      background-color: gold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="passwordPrompt">
  <h2>ğŸ” Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
  <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
  <br>
  <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="orders-container" style="display: none;">
  <h2>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>
</div>

<!-- Firebase SDK -->
<script type="module">
  // Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ¸Ø§Ø¦Ù Firebase Ù…Ù† CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getFirestore, collection, getDocs, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBFyrDJ8SSDgOVgug8-5jeVkkXzGtGJh4U",
    authDomain: "al-najjar-net.firebaseapp.com",
    projectId: "al-najjar-net",
    storageBucket: "al-najjar-net.firebasestorage.app",
    messagingSenderId: "134313830995",
    appId: "1:134313830995:web:7e55fb6a0099f7f8fcb4a6",
    measurementId: "G-FSMRSQNLRR"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const correctPassword = "7700Omar";
  const passwordPrompt = document.getElementById("passwordPrompt");
  const ordersContainer = document.getElementById("orders-container");

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    if (input === correctPassword) {
      passwordPrompt.style.display = "none";
      ordersContainer.style.display = "block";
      loadOrdersRealtime();
    } else {
      alert("âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Firestore ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
  function loadOrdersRealtime() {
    const ordersCol = collection(db, "orders");
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª ØªÙ†Ø§Ø²Ù„ÙŠÙ‹Ø§ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
    const q = query(ordersCol, orderBy("date", "desc"));

    onSnapshot(q, (querySnapshot) => {
      ordersContainer.innerHTML = "<h2>ğŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h2>";

      if (querySnapshot.empty) {
        ordersContainer.innerHTML += "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯.</p>";
        return;
      }

      querySnapshot.forEach((docSnap) => {
        const order = docSnap.data();

        const name = order.name || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        const phone = order.phone || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        const date = order.date || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        const items = order.items || [];

        const box = document.createElement("div");
        box.className = "order-box";
        box.innerHTML = `
          <h3>ğŸ•’ ${date}</h3>
          <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: <strong>${name}</strong></p>
          <p>ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: <strong>${phone}</strong></p>
          <div>
            <h4>ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h4>
            ${items.map(item => `
              <div class="product-item">
                <p><strong>${item.name}</strong></p>
                <p>Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty || 1} | Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø±ÙŠØ§Ù„</p>
              </div>
            `).join("")}
          </div>
          ${phone !== "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ" ? `
            <a class="whatsapp-btn" href="https://wa.me/${phone}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹%20${encodeURIComponent(name)}%20ØŒ%20ØªÙ…%20Ø§Ø³ØªÙ„Ø§Ù…%20Ø·Ù„Ø¨Ùƒ%20ÙˆØ³ÙˆÙ%20Ù†Ù‚ÙˆÙ…%20Ø¨Ø§Ù„ØªÙˆØ§ØµÙ„%20Ù…Ø¹Ùƒ%20Ø¨Ø´Ø£Ù†%20Ø§Ù„Ø·Ù„Ø¨." target="_blank">ğŸ“² ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
          ` : ""}
          <button class="delete-btn" onclick="deleteOrder('${docSnap.id}')">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
        `;

        ordersContainer.appendChild(box);
      });
    });
  }

  // Ø­Ø°Ù Ø·Ù„Ø¨ Ø­Ø³Ø¨ Ù…Ø¹Ø±Ù Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© ÙÙŠ Firestore
  async function deleteOrder(docId) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
      try {
        await deleteDoc(doc(db, "orders", docId));
        alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
      } catch (error) {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨");
        console.error(error);
      }
    }
  }

  // ØªØ¹ÙŠÙŠÙ† Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù Ø¥Ù„Ù‰ global Ù„ÙƒÙŠ ØªÙƒÙˆÙ† Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ø²Ø±
  window.deleteOrder = deleteOrder;
  window.checkPassword = checkPassword;
</script>

</body>
</html>